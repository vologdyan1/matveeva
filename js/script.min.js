const SECTION_IDS=["hero","services","portfolio","about","contacts"],header=document.querySelector(".page-header"),burger=document.querySelector(".page-header__burger"),nav=document.getElementById("page-header-nav"),isMenuOpen=()=>header?.classList.contains("page-header--menu-open"),closeMobileMenu=()=>{header&&(header.classList.remove("page-header--menu-open"),burger?.setAttribute("aria-expanded","false"),burger?.setAttribute("aria-label","Открыть меню"),document.body.style.overflow="")},openMobileMenu=()=>{header&&(header.classList.add("page-header--menu-open"),burger?.setAttribute("aria-expanded","true"),burger?.setAttribute("aria-label","Закрыть меню"),document.body.style.overflow="hidden")},handleBurgerClick=()=>{isMenuOpen()?closeMobileMenu():openMobileMenu()},handleBurgerKeyDown=e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),handleBurgerClick())};burger&&(burger.addEventListener("click",handleBurgerClick),burger.addEventListener("keydown",handleBurgerKeyDown));const HEADER_OFFSET_PX=()=>header?.offsetHeight??parseInt(getComputedStyle(document.documentElement).getPropertyValue("--header-height")||"80",10),scrollToSection=e=>{const t=document.getElementById(e);if(!t)return;const o=(t.querySelector(".section__title")||t).getBoundingClientRect().top+window.scrollY-HEADER_OFFSET_PX();window.scrollTo({top:Math.max(0,o),behavior:"smooth"})},handleSectionLinkClick=e=>{const t=(e.currentTarget.getAttribute("href")||"").slice(1);SECTION_IDS.includes(t)&&(e.preventDefault(),closeMobileMenu(),requestAnimationFrame(()=>requestAnimationFrame(()=>scrollToSection(t))))};document.querySelectorAll(".nav-list__link[href^='#']").forEach(e=>{const t=(e.getAttribute("href")||"").slice(1);SECTION_IDS.includes(t)&&e.addEventListener("click",handleSectionLinkClick)}),document.querySelectorAll(".page-footer__nav-link[href^='#']").forEach(e=>{const t=(e.getAttribute("href")||"").slice(1);SECTION_IDS.includes(t)&&e.addEventListener("click",e=>{e.preventDefault(),scrollToSection(t)})});const NAV_LINK_ACTIVE_CLASS="nav-list__link--active",SECTION_SELECTOR="[id='hero'], [id='services'], [id='portfolio'], [id='about'], [id='contacts']",navLinks=document.querySelectorAll(".nav-list__link[href^='#']"),sections=document.querySelectorAll(SECTION_SELECTOR);if(navLinks.length>0&&sections.length>0){const e=Array.from(sections).map(e=>e.id),t=e=>{navLinks.forEach(t=>{const o=t.getAttribute("href");(o?o.slice(1):"")===e?(t.classList.add(NAV_LINK_ACTIVE_CLASS),t.setAttribute("aria-current","location")):(t.classList.remove(NAV_LINK_ACTIVE_CLASS),t.removeAttribute("aria-current"))})},o=()=>{const t=(document.querySelector(".page-header")?.offsetHeight??80)+80,o=window.scrollY||window.pageYOffset,n=o+window.innerHeight>=document.documentElement.scrollHeight-t;let r=e[0];for(let e=sections.length-1;e>=0;e--){const n=sections[e];if(o>=n.getBoundingClientRect().top+o-t){r=n.id;break}}return n&&e.length>0&&(r=e[e.length-1]),r},n=()=>{t(o())},r=120;let l=!1;const s=()=>{l||(l=!0,n(),setTimeout(()=>{l=!1},r))};window.addEventListener("scroll",s,{passive:!0}),n()}const CONSULT_MODAL_ID="consult-modal",INVALID_CLASS_INPUT="consult-form__input--invalid",INVALID_CLASS_CHECKBOX="consult-form__checkbox--invalid",PHONE_PLACEHOLDER="+79999999999",WEB3FORMS_ENDPOINT="https://api.web3forms.com/submit",WEB3FORMS_ACCESS_KEY="e6f55808-55b4-452b-91bf-e4ceb94651ed",SUBMIT_BTN_LABEL_DEFAULT="Свяжитесь со мной",SUBMIT_BTN_LABEL_SENDING="Отправка…",modal=document.getElementById("consult-modal"),openBtns=document.querySelectorAll(".js-open-consult"),backdrop=modal?.querySelector(".modal__backdrop"),closeBtn=modal?.querySelector(".modal__close");let lastOpenTrigger=null,modalFocusTrapCleanup=null;const FOCUSABLE_SELECTOR='button:not([disabled]), [href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), [tabindex]:not([tabindex="-1"])',getFocusableElements=e=>e?Array.from(e.querySelectorAll(FOCUSABLE_SELECTOR)).filter(e=>"true"!==e.getAttribute("aria-hidden")&&null!==e.offsetParent):[],setupFocusTrap=(e,t)=>{const o=document.activeElement,n=t=>{if("Tab"!==t.key)return;if("false"!==e.getAttribute("aria-hidden"))return;const o=getFocusableElements(e);if(0===o.length)return;t.preventDefault(),t.stopPropagation();const n=document.activeElement,r=o.indexOf(n);let l;l=-1===r?0:t.shiftKey?r<=0?o.length-1:r-1:r>=o.length-1?0:r+1,o[l].focus()};document.addEventListener("keydown",n,!0);const r=t&&e.contains(t)?t:getFocusableElements(e)[0];return r?.focus(),e=>{document.removeEventListener("keydown",n,!0),(e??o)?.focus?.()}},setBackdropInert=e=>{Array.from(document.body.children).forEach(t=>{t!==e?t.setAttribute("inert",""):t.removeAttribute("inert")})},clearBackdropInert=()=>{Array.from(document.body.children).forEach(e=>e.removeAttribute("inert"))},onlyLettersRegex=/[^\p{L}\s]/gu,isNameValid=e=>{const t=e.trim();return 0!==t.length&&!onlyLettersRegex.test(t)},isPhoneValid=e=>{const t=e.replace(/\D/g,"");return e.startsWith("+7")&&t.length>=11},setInvalid=(e,t,o=INVALID_CLASS_INPUT)=>{e&&(e.classList.toggle(o,t),e.setAttribute("aria-invalid",t?"true":"false"))},initConsultForm=e=>{const{form:t,nameInput:o,phoneInput:n,consentCheckbox:r,submitBtn:l,phonePlaceholder:s=PHONE_PLACEHOLDER,onSuccess:a}=e;if(!t)return;const i=document.createElement("p");i.className="consult-form__status",i.setAttribute("role","status"),i.setAttribute("aria-live","polite"),l?.parentNode&&l.parentNode.insertBefore(i,l.nextSibling);const c=(e,t="")=>{i.textContent=e||"",i.classList.toggle("consult-form__status--error","error"===t),i.classList.toggle("consult-form__status--success","success"===t)},d=()=>{if(!l)return;const e=isNameValid(o?.value??""),t=isPhoneValid(n?.value??""),s=!0===r?.checked;l.disabled=!(e&&t&&s)};t.addEventListener("submit",async e=>{if(e.preventDefault(),setInvalid(o,!isNameValid(o?.value??"")),setInvalid(n,!isPhoneValid(n?.value??"")),setInvalid(r,!(!0===r?.checked),INVALID_CLASS_CHECKBOX),isNameValid(o?.value??"")&&isPhoneValid(n?.value??"")&&r?.checked){c(""),l&&(l.disabled=!0,l.textContent="Отправка…");try{const e=await fetch(WEB3FORMS_ENDPOINT,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({access_key:WEB3FORMS_ACCESS_KEY,name:(o?.value??"").trim(),phone:(n?.value??"").trim()})}),r=await e.json().catch(()=>({}));e.ok&&r.success?(t.reset(),n&&(n.placeholder=s),d(),c("Спасибо! Заявка отправлена. Мы свяжемся с вами в ближайшее время.","success"),a&&setTimeout(a,2e3)):(c("Не удалось отправить заявку. Попробуйте позже или позвоните нам.","error"),d())}catch{c("Не удалось отправить заявку. Проверьте интернет и попробуйте снова.","error"),d()}finally{l&&(l.textContent="Свяжитесь со мной"),d()}}}),o?.addEventListener("input",e=>{const t=e.target,o=t.selectionStart,n=t.value.length;t.value=t.value.replace(onlyLettersRegex,"");const r=t.value.length;t.setSelectionRange(o-(n-r),o-(n-r)),setInvalid(t,!1),d()}),o?.addEventListener("blur",()=>setInvalid(o,!isNameValid(o.value)&&o.value.length>0)),n?.addEventListener("input",e=>{const t=e.target;let o=t.value.replace(/[^\d+]/g,"");o.startsWith("8")&&(o="+7"+o.slice(1)),o.length>1&&!o.startsWith("+")&&(o="+7"+o.replace(/^7?/,"")),"+"===o||""===o?o="":"+"!==o[0]&&(o="+7"+o.replace(/^7?/,"")),t.value=o,setInvalid(t,!1),d()}),n?.addEventListener("focus",()=>{n.placeholder&&(n.placeholder="")}),n?.addEventListener("blur",()=>{0===n.value.length&&(n.placeholder=s),setInvalid(n,n.value.length>0&&!isPhoneValid(n.value))}),r?.addEventListener("change",()=>{setInvalid(r,!1),d()}),d()},openModal=e=>{if(!modal)return;lastOpenTrigger=e??null;const t=document.getElementById("consult-form"),o=document.getElementById("consult-name"),n=document.getElementById("consult-phone"),r=document.getElementById("consult-consent");setInvalid(o,!1),setInvalid(n,!1),setInvalid(r,!1,INVALID_CLASS_CHECKBOX);const l=t?.querySelector(".consult-form__submit");if(l){const e=isNameValid(o?.value??""),t=isPhoneValid(n?.value??""),s=!0===r?.checked;l.disabled=!(e&&t&&s)}modal.setAttribute("aria-hidden","false"),document.body.style.overflow="hidden",setBackdropInert(modal),modalFocusTrapCleanup&&modalFocusTrapCleanup(),modalFocusTrapCleanup=setupFocusTrap(modal,o??closeBtn)},closeModal=()=>{modal&&(modalFocusTrapCleanup&&(modalFocusTrapCleanup(lastOpenTrigger),modalFocusTrapCleanup=null),modal.setAttribute("aria-hidden","true"),document.body.style.overflow="",clearBackdropInert())};openBtns.length>0&&openBtns.forEach(e=>e.addEventListener("click",e=>{e.preventDefault(),openModal(e.currentTarget)})),backdrop&&backdrop.addEventListener("click",e=>{e.target===backdrop&&closeModal()}),closeBtn&&closeBtn.addEventListener("click",closeModal);const ESCAPE_CLOSE_REGISTRY=[];ESCAPE_CLOSE_REGISTRY.push({isOpen:()=>isMenuOpen(),close:closeMobileMenu}),ESCAPE_CLOSE_REGISTRY.push({isOpen:()=>"false"===modal?.getAttribute("aria-hidden"),close:closeModal}),initConsultForm({form:document.getElementById("consult-form"),nameInput:document.getElementById("consult-name"),phoneInput:document.getElementById("consult-phone"),consentCheckbox:document.getElementById("consult-consent"),submitBtn:document.getElementById("consult-form")?.querySelector(".consult-form__submit")??null,phonePlaceholder:PHONE_PLACEHOLDER,onSuccess:closeModal}),initConsultForm({form:document.getElementById("contacts-form"),nameInput:document.getElementById("contacts-name"),phoneInput:document.getElementById("contacts-phone"),consentCheckbox:document.getElementById("contacts-consent"),submitBtn:document.getElementById("contacts-form")?.querySelector(".consult-form__submit")??null,phonePlaceholder:PHONE_PLACEHOLDER});const GALLERY_LIGHTBOX_ID="gallery-lightbox",lightbox=document.getElementById("gallery-lightbox"),projectGallerySection=document.querySelector(".section.project-gallery");if(lightbox&&projectGallerySection){const e=lightbox.querySelector(".lightbox__img"),t=lightbox.querySelector(".lightbox__backdrop"),o=lightbox.querySelector(".lightbox__close"),n=projectGallerySection.querySelectorAll(".project-gallery__item");let r=null,l=null;const s=(t,n,s)=>{e.src=t,e.alt=n??"",r=s??null,lightbox.setAttribute("aria-hidden","false"),document.body.style.overflow="hidden",setBackdropInert(lightbox),l&&l(),l=setupFocusTrap(lightbox,o)},a=()=>{l&&(l(r),l=null),r=null,lightbox.setAttribute("aria-hidden","true"),document.body.style.overflow="",clearBackdropInert()},i=e=>{const t=e.currentTarget.querySelector("img");if(!t?.src)return;e.preventDefault();const o=t.currentSrc||t.src;s(o,t.alt,e.currentTarget)};n.forEach(e=>{e.setAttribute("tabindex","0"),e.addEventListener("click",i),e.addEventListener("keydown",t=>{"Enter"!==t.key&&" "!==t.key||(t.preventDefault(),e.click())})}),t?.addEventListener("click",a),o?.addEventListener("click",a),ESCAPE_CLOSE_REGISTRY.push({isOpen:()=>"false"===lightbox.getAttribute("aria-hidden"),close:a})}const servicesLightbox=document.getElementById("services-lightbox");if(servicesLightbox){const e=servicesLightbox.querySelector(".lightbox__img"),t=servicesLightbox.querySelector(".lightbox__backdrop"),o=servicesLightbox.querySelector(".lightbox__close"),n=servicesLightbox.querySelector(".lightbox__nav--prev"),r=servicesLightbox.querySelector(".lightbox__nav--next");let l=-1,s=null,a=null;const i="lightbox__nav--hidden",c=e=>{const t=!e;n&&(n.setAttribute("aria-hidden",t),n.classList.toggle(i,!e)),r&&(r.setAttribute("aria-hidden",t),r.classList.toggle(i,!e))},d=t=>{const o=window.__CAROUSEL_ITEMS||[];if(t<0||t>=o.length)return;l=t;const s=o[t];s&&e&&(servicesLightbox.classList.add("lightbox--loading"),e.alt=s.caption??"",e.onload=()=>servicesLightbox.classList.remove("lightbox--loading"),e.onerror=()=>{e.onerror=null,servicesLightbox.classList.remove("lightbox--loading")},e.src=CAROUSEL_LIGHTBOX_BASE+String(t).padStart(2,"0")+".webp",n&&n.classList.toggle(i,t<=0),r&&r.classList.toggle(i,t>=o.length-1))},u=(t,n,r,i)=>{if(!e)return;l=r??-1,s=i??null;const u="number"==typeof r&&r>=0;c(u),u?d(r):(servicesLightbox.classList.add("lightbox--loading"),e.alt=n??"",e.onload=()=>servicesLightbox.classList.remove("lightbox--loading"),e.src=t),servicesLightbox.setAttribute("aria-hidden","false"),document.body.style.overflow="hidden",setBackdropInert(servicesLightbox),a&&a(),a=setupFocusTrap(servicesLightbox,o)},g=()=>{a&&(a(s),a=null),s=null,servicesLightbox.setAttribute("aria-hidden","true"),servicesLightbox.classList.remove("lightbox--loading"),l=-1,document.body.style.overflow="",clearBackdropInert()};n&&(n.classList.add(i),n.addEventListener("click",e=>{e.stopPropagation(),l<=0||d(l-1)})),r&&(r.classList.add(i),r.addEventListener("click",e=>{e.stopPropagation();const t=window.__CAROUSEL_ITEMS||[];l<0||l>=t.length-1||d(l+1)}));const p=e=>{if("false"!==servicesLightbox.getAttribute("aria-hidden")||l<0)return;const t=window.__CAROUSEL_ITEMS||[];"ArrowLeft"===e.key?(e.preventDefault(),l>0&&d(l-1)):"ArrowRight"===e.key&&(e.preventDefault(),l<t.length-1&&d(l+1))};window.addEventListener("keydown",p);const h=document.querySelectorAll(".js-open-included"),m=e=>{const t=e.currentTarget,o=t.getAttribute("data-included-src"),n=t.getAttribute("data-included-alt")??"";o&&(e.preventDefault(),u(o,n,void 0,t))},E=e=>{if("Enter"!==e.key&&" "!==e.key)return;const t=e.currentTarget,o=t.getAttribute("data-included-src"),n=t.getAttribute("data-included-alt")??"";o&&(e.preventDefault(),u(o,n,void 0,t))};h.forEach(e=>{e.addEventListener("click",m),e.addEventListener("keydown",E)}),t?.addEventListener("click",g),o?.addEventListener("click",g),ESCAPE_CLOSE_REGISTRY.push({isOpen:()=>"false"===servicesLightbox.getAttribute("aria-hidden"),close:g});const b=document.querySelector(".portfolio-carousel");if(b){const e=e=>{const t=e.target.closest(".js-carousel-lightbox");if(!t)return;const o=t.getAttribute("data-full-src")||t.querySelector("img")?.src,n=t.querySelector("img")?.alt??"",r=t.getAttribute("data-carousel-index"),l=null!==r?parseInt(r,10):-1;o&&(e.preventDefault(),u(o,n,l,t))};b.addEventListener("click",e),b.addEventListener("keydown",t=>{"Enter"!==t.key&&" "!==t.key||e(t)})}}const CAROUSEL_LIGHTBOX_BASE="assets/carousel-lightbox/",CAROUSEL_ITEMS=[{caption:"1 обмерный план"},{caption:"2 Схема демонтажа перегородок"},{caption:"2.1 Схема монтажа перегородок"},{caption:"3 План расстановки мебели"},{caption:"4 Схема сантехники"},{caption:"4.1 Схема сантехники"},{caption:"4.2 Сантех привязка кондиционеров"},{caption:"5 Схема потолков"},{caption:"6 Схема напольных покрытий"},{caption:"7 Схема светильников"},{caption:"8 Схема розеток"},{caption:"9 Ведомость светильников"},{caption:"10 Спецификация розеточных блоков"},{caption:"11 Схема отделки стен"},{caption:"12 Развертки по стенам коридора"},{caption:"12.1 Развертки стен коридора 2"},{caption:"13 Развертки по стенам кухни гостиной"},{caption:"13.1 Развертки по стенам кухни гостиной 2"},{caption:"14 Развертки по стенам спальни"},{caption:"15 Развертки по стенам детской 1"},{caption:"15.1 Развертки по стенам детской 2"},{caption:"16 развертки по стенам душевой"},{caption:"16.1 Развертки по стенам ванной"},{caption:"17 Ведомость заполнения дверных проемов"},{caption:"18 Сводная ведомость отделки потолка и стен 1"},{caption:"18.1 Сводная ведомость отделки потолка и стен 2"}];window.__CAROUSEL_ITEMS=CAROUSEL_ITEMS;const CAROUSEL_PLACEHOLDER="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='300' viewBox='0 0 400 300'%3E%3Crect fill='%23eaeaea' width='400' height='300'/%3E%3C/svg%3E",carousel=document.querySelector(".portfolio-carousel");if(carousel){const e=carousel.querySelector(".portfolio-carousel__track"),t=carousel.querySelector(".portfolio-carousel__dots"),o=carousel.querySelector(".portfolio-carousel__viewport");let n=!1;const r=()=>{if(!e||0===CAROUSEL_ITEMS.length)return;n=!0,e.innerHTML="";let t=0;CAROUSEL_ITEMS.forEach((t,o)=>{const n="assets/carousel-thumbs/"+String(o).padStart(2,"0")+".webp",r=t.caption.replace(/"/g,"&quot;"),l=document.createElement("li");l.className="portfolio-carousel__slide";const s=document.createElement("button");s.type="button",s.className="portfolio-carousel__thumb js-carousel-lightbox",s.setAttribute("tabindex","0"),s.setAttribute("aria-label","Открыть фото: "+r),s.setAttribute("data-full-src",CAROUSEL_LIGHTBOX_BASE+String(o).padStart(2,"0")+".webp"),s.setAttribute("data-carousel-index",String(o));const a=document.createElement("img");a.dataset.src=n,a.alt=t.caption,a.width=400,a.height=300,a.loading="lazy",a.decoding="async",s.appendChild(a),l.appendChild(s);const i=document.createElement("p");i.className="portfolio-carousel__caption",i.textContent=t.caption,l.appendChild(i),e.appendChild(l)});const r=new IntersectionObserver(e=>{e.forEach(e=>{if(!e.isIntersecting)return;const o=e.target.querySelector("img");o&&!o.src&&(e=>{if(!e||e.src||t>=6)return;const o=e.dataset.src;o&&(t+=1,e.onload=()=>{t-=1},e.onerror=()=>{t-=1,e.src=CAROUSEL_PLACEHOLDER},e.src=o)})(o)})},{root:o||null,rootMargin:"40px",threshold:.01});e.querySelectorAll(".portfolio-carousel__slide").forEach(e=>r.observe(e))},l=()=>{if(t&&CAROUSEL_ITEMS.length>0){t.innerHTML="";const e=Math.max(0,CAROUSEL_ITEMS.length-3);for(let o=0;o<e;o++){const e=document.createElement("button");e.type="button",e.className="portfolio-carousel__dot",e.setAttribute("role","tab"),e.setAttribute("aria-label","Слайд "+(o+1)),e.setAttribute("data-index",String(o)),e.setAttribute("aria-selected",0===o?"true":"false"),t.appendChild(e)}}const o=carousel.querySelectorAll(".portfolio-carousel__slide"),n=carousel.querySelector(".portfolio-carousel__nav--prev"),r=carousel.querySelector(".portfolio-carousel__nav--next"),l=carousel.querySelectorAll(".portfolio-carousel__dot"),s=o.length,a=Math.max(0,s-4);let i=0;const c=()=>{if(!e||!o[0])return;const t=o[0].getBoundingClientRect().width,n=parseFloat(getComputedStyle(e).gap)||12,r=-i*(t+n);e.style.transform=`translateX(${r}px)`},d=e=>{i=Math.max(0,Math.min(e,a)),c(),l.forEach((e,t)=>{e.setAttribute("aria-selected",t===i?"true":"false")})};n&&n.addEventListener("click",()=>d(i-1)),r&&r.addEventListener("click",()=>d(i+1)),l.forEach(e=>{e.addEventListener("click",e=>{const t=e.target.closest(".portfolio-carousel__dot");if(!t)return;const o=parseInt(t.getAttribute("data-index"),10);Number.isNaN(o)||d(o)})});let u=null;window.addEventListener("resize",()=>{u&&clearTimeout(u),u=setTimeout(c,150)}),c()},s=new IntersectionObserver(e=>{const t=e[0];t?.isIntersecting&&!n&&(r(),l(),s.disconnect())},{root:null,rootMargin:"100px",threshold:0});s.observe(carousel)}window.addEventListener("keydown",e=>{if("Escape"===e.key)for(const e of ESCAPE_CLOSE_REGISTRY)if(e.isOpen()){e.close();break}});