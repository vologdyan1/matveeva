const SECTION_IDS=["hero","services","portfolio","about","contacts"],header=document.querySelector(".page-header"),burger=document.querySelector(".page-header__burger"),nav=document.getElementById("page-header-nav"),isMenuOpen=()=>header?.classList.contains("page-header--menu-open"),closeMobileMenu=()=>{header&&(header.classList.remove("page-header--menu-open"),burger?.setAttribute("aria-expanded","false"),burger?.setAttribute("aria-label","Открыть меню"),document.body.style.overflow="")},openMobileMenu=()=>{header&&(header.classList.add("page-header--menu-open"),burger?.setAttribute("aria-expanded","true"),burger?.setAttribute("aria-label","Закрыть меню"),document.body.style.overflow="hidden")},handleBurgerClick=()=>{isMenuOpen()?closeMobileMenu():openMobileMenu()},handleBurgerKeyDown=e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),handleBurgerClick())};burger&&(burger.addEventListener("click",handleBurgerClick),burger.addEventListener("keydown",handleBurgerKeyDown));const scrollToSection=e=>{const t=document.getElementById(e);t&&t.scrollIntoView({behavior:"smooth",block:"start"})},handleSectionLinkClick=e=>{const t=(e.currentTarget.getAttribute("href")||"").slice(1);SECTION_IDS.includes(t)&&(e.preventDefault(),closeMobileMenu(),scrollToSection(t))};document.querySelectorAll(".nav-list__link[href^='#']").forEach(e=>{const t=(e.getAttribute("href")||"").slice(1);SECTION_IDS.includes(t)&&e.addEventListener("click",handleSectionLinkClick)}),document.querySelectorAll(".page-footer__nav-link[href^='#']").forEach(e=>{const t=(e.getAttribute("href")||"").slice(1);SECTION_IDS.includes(t)&&e.addEventListener("click",e=>{e.preventDefault(),scrollToSection(t)})});const NAV_LINK_ACTIVE_CLASS="nav-list__link--active",SECTION_SELECTOR="[id='hero'], [id='services'], [id='portfolio'], [id='about'], [id='contacts']",navLinks=document.querySelectorAll(".nav-list__link[href^='#']"),sections=document.querySelectorAll(SECTION_SELECTOR);if(navLinks.length>0&&sections.length>0){const e=Array.from(sections).map(e=>e.id),t=e=>{navLinks.forEach(t=>{const o=t.getAttribute("href");(o?o.slice(1):"")===e?(t.classList.add(NAV_LINK_ACTIVE_CLASS),t.setAttribute("aria-current","location")):(t.classList.remove(NAV_LINK_ACTIVE_CLASS),t.removeAttribute("aria-current"))})},o=()=>{const t=(document.querySelector(".page-header")?.offsetHeight??80)+80,o=window.scrollY||window.pageYOffset,n=o+window.innerHeight>=document.documentElement.scrollHeight-t;let s=e[0];for(let e=sections.length-1;e>=0;e--){const n=sections[e];if(o>=n.getBoundingClientRect().top+o-t){s=n.id;break}}return n&&e.length>0&&(s=e[e.length-1]),s},n=()=>{t(o())},s=120;let r=!1;const l=()=>{r||(r=!0,n(),setTimeout(()=>{r=!1},s))};window.addEventListener("scroll",l,{passive:!0}),n()}const CONSULT_MODAL_ID="consult-modal",INVALID_CLASS="form-input--invalid",PHONE_PLACEHOLDER="+79999999999",WEB3FORMS_ENDPOINT="https://api.web3forms.com/submit",WEB3FORMS_ACCESS_KEY="e6f55808-55b4-452b-91bf-e4ceb94651ed",SUBMIT_BTN_LABEL_DEFAULT="Свяжитесь со мной",SUBMIT_BTN_LABEL_SENDING="Отправка…",modal=document.getElementById("consult-modal"),openBtns=document.querySelectorAll(".js-open-consult"),backdrop=modal?.querySelector(".modal__backdrop"),closeBtn=modal?.querySelector(".modal__close");let lastOpenTrigger=null;const onlyLettersRegex=/[^\p{L}\s]/gu,isNameValid=e=>{const t=e.trim();return 0!==t.length&&!onlyLettersRegex.test(t)},isPhoneValid=e=>{const t=e.replace(/\D/g,"");return e.startsWith("+7")&&t.length>=11},setInvalid=(e,t)=>{e&&(e.classList.toggle(INVALID_CLASS,t),e.setAttribute("aria-invalid",t?"true":"false"))},initConsultForm=e=>{const{form:t,nameInput:o,phoneInput:n,consentCheckbox:s,submitBtn:r,phonePlaceholder:l=PHONE_PLACEHOLDER,onSuccess:c}=e;if(!t)return;const a=document.createElement("p");a.className="consult-form__status",a.setAttribute("role","status"),a.setAttribute("aria-live","polite"),r?.parentNode&&r.parentNode.insertBefore(a,r.nextSibling);const i=(e,t="")=>{a.textContent=e||"",a.classList.toggle("consult-form__status--error","error"===t),a.classList.toggle("consult-form__status--success","success"===t)},d=()=>{if(!r)return;const e=isNameValid(o?.value??""),t=isPhoneValid(n?.value??""),l=!0===s?.checked;r.disabled=!(e&&t&&l)};t.addEventListener("submit",async e=>{if(e.preventDefault(),setInvalid(o,!isNameValid(o?.value??"")),setInvalid(n,!isPhoneValid(n?.value??"")),setInvalid(s,!(!0===s?.checked)),isNameValid(o?.value??"")&&isPhoneValid(n?.value??"")&&s?.checked){i(""),r&&(r.disabled=!0,r.textContent="Отправка…");try{const e=await fetch(WEB3FORMS_ENDPOINT,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({access_key:WEB3FORMS_ACCESS_KEY,name:(o?.value??"").trim(),phone:(n?.value??"").trim()})}),s=await e.json().catch(()=>({}));e.ok&&s.success?(t.reset(),n&&(n.placeholder=l),d(),i("Спасибо! Заявка отправлена. Мы свяжемся с вами в ближайшее время.","success"),c&&setTimeout(c,2e3)):(i("Не удалось отправить заявку. Попробуйте позже или позвоните нам.","error"),d())}catch{i("Не удалось отправить заявку. Проверьте интернет и попробуйте снова.","error"),d()}finally{r&&(r.textContent="Свяжитесь со мной"),d()}}}),o?.addEventListener("input",e=>{const t=e.target,o=t.selectionStart,n=t.value.length;t.value=t.value.replace(onlyLettersRegex,"");const s=t.value.length;t.setSelectionRange(o-(n-s),o-(n-s)),setInvalid(t,!1),d()}),o?.addEventListener("blur",()=>setInvalid(o,!isNameValid(o.value)&&o.value.length>0)),n?.addEventListener("input",e=>{const t=e.target;let o=t.value;o.startsWith("8")&&(o="+7"+o.slice(1)),o=o.replace(/[^\d+]/g,""),o.length>1&&!o.startsWith("+")&&(o="+7"+o.replace(/^7?/,"")),"+"===o||""===o?o="":o.length>0&&"+"!==o[0]&&(o="+7"+o.replace(/^7?/,"")),t.value=o,setInvalid(t,!1),d()}),n?.addEventListener("focus",()=>{n.placeholder&&(n.placeholder="")}),n?.addEventListener("blur",()=>{0===n.value.length&&(n.placeholder=l),setInvalid(n,n.value.length>0&&!isPhoneValid(n.value))}),s?.addEventListener("change",()=>{setInvalid(s,!1),d()}),d()},openModal=e=>{if(!modal)return;lastOpenTrigger=e??null;const t=document.getElementById("consult-form"),o=document.getElementById("consult-name"),n=document.getElementById("consult-phone"),s=document.getElementById("consult-consent");setInvalid(o,!1),setInvalid(n,!1),setInvalid(s,!1);const r=t?.querySelector(".consult-form__submit");if(r){const e=isNameValid(o?.value??""),t=isPhoneValid(n?.value??""),l=!0===s?.checked;r.disabled=!(e&&t&&l)}modal.setAttribute("aria-hidden","false"),document.body.style.overflow="hidden",closeBtn?.focus()},closeModal=()=>{modal&&(modal.setAttribute("aria-hidden","true"),document.body.style.overflow="",lastOpenTrigger?.focus?.())};openBtns.length>0&&openBtns.forEach(e=>e.addEventListener("click",e=>{e.preventDefault(),openModal(e.currentTarget)})),backdrop&&backdrop.addEventListener("click",e=>{e.target===backdrop&&closeModal()}),closeBtn&&closeBtn.addEventListener("click",closeModal);const ESCAPE_CLOSE_REGISTRY=[];ESCAPE_CLOSE_REGISTRY.push({isOpen:()=>isMenuOpen(),close:closeMobileMenu}),ESCAPE_CLOSE_REGISTRY.push({isOpen:()=>"false"===modal?.getAttribute("aria-hidden"),close:closeModal}),initConsultForm({form:document.getElementById("consult-form"),nameInput:document.getElementById("consult-name"),phoneInput:document.getElementById("consult-phone"),consentCheckbox:document.getElementById("consult-consent"),submitBtn:document.getElementById("consult-form")?.querySelector(".consult-form__submit")??null,phonePlaceholder:PHONE_PLACEHOLDER,onSuccess:closeModal}),initConsultForm({form:document.getElementById("contacts-form"),nameInput:document.getElementById("contacts-name"),phoneInput:document.getElementById("contacts-phone"),consentCheckbox:document.getElementById("contacts-consent"),submitBtn:document.getElementById("contacts-form")?.querySelector(".consult-form__submit")??null,phonePlaceholder:PHONE_PLACEHOLDER});const lightbox=document.getElementById("gallery-lightbox"),projectGallerySection=document.querySelector(".section.project-gallery");if(lightbox&&projectGallerySection){const e=lightbox.querySelector(".lightbox__img"),t=lightbox.querySelector(".lightbox__backdrop"),o=lightbox.querySelector(".lightbox__close"),n=projectGallerySection.querySelectorAll(".project-gallery__item"),s=(t,n)=>{e.src=t,e.alt=n??"",lightbox.setAttribute("aria-hidden","false"),document.body.style.overflow="hidden",o?.focus()},r=()=>{lightbox.setAttribute("aria-hidden","true"),document.body.style.overflow=""},l=e=>{const t=e.currentTarget.querySelector("img");t?.src&&(e.preventDefault(),s(t.src,t.alt))};n.forEach(e=>{e.addEventListener("click",l)}),t?.addEventListener("click",r),o?.addEventListener("click",r),ESCAPE_CLOSE_REGISTRY.push({isOpen:()=>"false"===lightbox.getAttribute("aria-hidden"),close:r})}const servicesLightbox=document.getElementById("services-lightbox");if(servicesLightbox){const e=servicesLightbox.querySelector(".lightbox__img"),t=servicesLightbox.querySelector(".lightbox__backdrop"),o=servicesLightbox.querySelector(".lightbox__close"),n=servicesLightbox.querySelector(".lightbox__nav--prev"),s=servicesLightbox.querySelector(".lightbox__nav--next");let r=-1;const l=e=>{const t=!e;n&&(n.setAttribute("aria-hidden",t),n.style.display=e?"":"none"),s&&(s.setAttribute("aria-hidden",t),s.style.display=e?"":"none")},c="assets/carousel-lightbox/",a=t=>{const o=window.__CAROUSEL_ITEMS||[];if(t<0||t>=o.length)return;r=t;const l=o[t];l&&e&&(servicesLightbox.classList.add("lightbox--loading"),e.alt=l.caption??"",e.onload=()=>servicesLightbox.classList.remove("lightbox--loading"),e.onerror=()=>{e.onerror=null,e.src=l.src},e.src=c+String(t).padStart(2,"0")+".webp",n&&(n.style.visibility=t>0?"":"hidden"),s&&(s.style.visibility=t<o.length-1?"":"hidden"))},i=(t,c,i)=>{if(!e)return;r=i??-1;const d="number"==typeof i&&i>=0;l(d),d?a(i):(servicesLightbox.classList.add("lightbox--loading"),e.alt=c??"",e.onload=()=>servicesLightbox.classList.remove("lightbox--loading"),e.src=t,n&&(n.style.visibility=""),s&&(s.style.visibility="")),servicesLightbox.setAttribute("aria-hidden","false"),document.body.style.overflow="hidden",o?.focus()},d=()=>{servicesLightbox.setAttribute("aria-hidden","true"),servicesLightbox.classList.remove("lightbox--loading"),r=-1,document.body.style.overflow=""};n&&(n.style.display="none",n.addEventListener("click",e=>{e.stopPropagation(),r<=0||a(r-1)})),s&&(s.style.display="none",s.addEventListener("click",e=>{e.stopPropagation();const t=window.__CAROUSEL_ITEMS||[];r<0||r>=t.length-1||a(r+1)}));const u=e=>{if("false"!==servicesLightbox.getAttribute("aria-hidden")||r<0)return;const t=window.__CAROUSEL_ITEMS||[];"ArrowLeft"===e.key?(e.preventDefault(),r>0&&a(r-1)):"ArrowRight"===e.key&&(e.preventDefault(),r<t.length-1&&a(r+1))};window.addEventListener("keydown",u);const g=document.querySelectorAll(".js-open-included"),p=e=>{const t=e.currentTarget,o=t.getAttribute("data-included-src"),n=t.getAttribute("data-included-alt")??"";o&&(e.preventDefault(),i(o,n))},h=e=>{if("Enter"!==e.key&&" "!==e.key)return;const t=e.currentTarget,o=t.getAttribute("data-included-src"),n=t.getAttribute("data-included-alt")??"";o&&(e.preventDefault(),i(o,n))};g.forEach(e=>{e.addEventListener("click",p),e.addEventListener("keydown",h)}),t?.addEventListener("click",d),o?.addEventListener("click",d),ESCAPE_CLOSE_REGISTRY.push({isOpen:()=>"false"===servicesLightbox.getAttribute("aria-hidden"),close:d});const m=document.querySelector(".portfolio-carousel");if(m){const e=e=>{const t=e.target.closest(".js-carousel-lightbox");if(!t)return;const o=t.getAttribute("data-full-src")||t.querySelector("img")?.src,n=t.querySelector("img")?.alt??"",s=t.getAttribute("data-carousel-index"),r=null!==s?parseInt(s,10):-1;o&&(e.preventDefault(),i(o,n,r))};m.addEventListener("click",e),m.addEventListener("keydown",t=>{"Enter"!==t.key&&" "!==t.key||e(t)})}}const CAROUSEL_ITEMS=[{src:"assets/1 обмерный план.png",caption:"1 обмерный план"},{src:"assets/2 Схема демонтажа перегородок.png",caption:"2 Схема демонтажа перегородок"},{src:"assets/2.1 Схема монтажа перегородок.png",caption:"2.1 Схема монтажа перегородок"},{src:"assets/3 План расстановки мебели.png",caption:"3 План расстановки мебели"},{src:"assets/4 Схема сантехники.png",caption:"4 Схема сантехники"},{src:"assets/4.1 Схема сантехники.png",caption:"4.1 Схема сантехники"},{src:"assets/4х- комнатная квартира - 4.12.25_Page18.png",caption:"4х- комнатная квартира - 4.12.25_Page18"},{src:"assets/5 Схема потолков.png",caption:"5 Схема потолков"},{src:"assets/6 Схема напольных покрытий.png",caption:"6 Схема напольных покрытий"},{src:"assets/7 Схема светильников.png",caption:"7 Схема светильников"},{src:"assets/8 Схема розеток.png",caption:"8 Схема розеток"},{src:"assets/9 Ведомость светильников.png",caption:"9 Ведомость светильников"},{src:"assets/10 Спецификация розеточных блоков.png",caption:"10 Спецификация розеточных блоков"},{src:"assets/11 Схема отделки стен.png",caption:"11 Схема отделки стен"},{src:"assets/12 Развертки по стенам коридора.png",caption:"12 Развертки по стенам коридора"},{src:"assets/12.1 Развертки стен коридора 2.png",caption:"12.1 Развертки стен коридора 2"},{src:"assets/13 Развертки по стенам кухни гостиной.png",caption:"13 Развертки по стенам кухни гостиной"},{src:"assets/13.1 Размервертки по стенам кухни гостиной 2.png",caption:"13.1 Размервертки по стенам кухни гостиной 2"},{src:"assets/14 Развертки по стенам спальни.png",caption:"14 Развертки по стенам спальни"},{src:"assets/15 Развертки по стенам детской 1.png",caption:"15 Развертки по стенам детской 1"},{src:"assets/15.1 Развертки по стенам детской 2.png",caption:"15.1 Развертки по стенам детской 2"},{src:"assets/16 развертки по стенам душевой.png",caption:"16 развертки по стенам душевой"},{src:"assets/16.1 Развертки по стенам ванной.png",caption:"16.1 Развертки по стенам ванной"},{src:"assets/17 Ведомость заполнения дверных проемов.png",caption:"17 Ведомость заполнения дверных проемов"},{src:"assets/18 Сводная ведомость отделки потолка и стен 1.png",caption:"18 Сводная ведомость отделки потолка и стен 1"},{src:"assets/18.1 Сводная ведомость отделки потолка и стен 2.png",caption:"18.1 Сводная ведомость отделки потолка и стен 2"}];window.__CAROUSEL_ITEMS=CAROUSEL_ITEMS;const CAROUSEL_PLACEHOLDER="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='300' viewBox='0 0 400 300'%3E%3Crect fill='%23eaeaea' width='400' height='300'/%3E%3C/svg%3E",carousel=document.querySelector(".portfolio-carousel");if(carousel){const e=carousel.querySelector(".portfolio-carousel__track"),t=carousel.querySelector(".portfolio-carousel__dots"),o=carousel.querySelector(".portfolio-carousel__viewport");let n=!1;const s=()=>{if(!e||0===CAROUSEL_ITEMS.length)return;n=!0,e.innerHTML="";let t=0;CAROUSEL_ITEMS.forEach((t,o)=>{const n="assets/carousel-thumbs/"+String(o).padStart(2,"0")+".webp",s=t.caption.replace(/"/g,"&quot;"),r=document.createElement("li");r.className="portfolio-carousel__slide";const l=document.createElement("button");l.type="button",l.className="portfolio-carousel__thumb js-carousel-lightbox",l.setAttribute("tabindex","0"),l.setAttribute("aria-label","Открыть фото: "+s),l.setAttribute("data-full-src",t.src),l.setAttribute("data-carousel-index",String(o));const c=document.createElement("img");c.dataset.src=n,c.alt=t.caption,c.width=400,c.height=300,c.loading="lazy",c.decoding="async",l.appendChild(c),r.appendChild(l);const a=document.createElement("p");a.className="portfolio-carousel__caption",a.textContent=t.caption,r.appendChild(a),e.appendChild(r)});const s=new IntersectionObserver(e=>{e.forEach(e=>{if(!e.isIntersecting)return;const o=e.target.querySelector("img");o&&!o.src&&(e=>{if(!e||e.src||t>=6)return;const o=e.dataset.src;o&&(t+=1,e.onload=()=>{t-=1},e.onerror=()=>{t-=1,e.src=CAROUSEL_PLACEHOLDER},e.src=o)})(o)})},{root:o||null,rootMargin:"40px",threshold:.01});e.querySelectorAll(".portfolio-carousel__slide").forEach(e=>s.observe(e))},r=()=>{if(t&&CAROUSEL_ITEMS.length>0){t.innerHTML="";const e=Math.max(0,CAROUSEL_ITEMS.length-3);for(let o=0;o<e;o++){const e=document.createElement("button");e.type="button",e.className="portfolio-carousel__dot",e.setAttribute("role","tab"),e.setAttribute("aria-label","Слайд "+(o+1)),e.setAttribute("data-index",String(o)),e.setAttribute("aria-selected",0===o?"true":"false"),t.appendChild(e)}}const o=carousel.querySelectorAll(".portfolio-carousel__slide"),n=carousel.querySelector(".portfolio-carousel__nav--prev"),s=carousel.querySelector(".portfolio-carousel__nav--next"),r=carousel.querySelectorAll(".portfolio-carousel__dot"),l=o.length,c=Math.max(0,l-4);let a=0;const i=()=>{if(!e||!o[0])return;const t=o[0].getBoundingClientRect().width,n=parseFloat(getComputedStyle(e).gap)||12,s=-a*(t+n);e.style.transform=`translateX(${s}px)`},d=e=>{a=Math.max(0,Math.min(e,c)),i(),r.forEach((e,t)=>{e.setAttribute("aria-selected",t===a?"true":"false")})};n&&n.addEventListener("click",()=>d(a-1)),s&&s.addEventListener("click",()=>d(a+1)),r.forEach(e=>{e.addEventListener("click",e=>{const t=e.target.closest(".portfolio-carousel__dot");if(!t)return;const o=parseInt(t.getAttribute("data-index"),10);Number.isNaN(o)||d(o)})});let u=null;window.addEventListener("resize",()=>{u&&clearTimeout(u),u=setTimeout(i,150)}),i()},l=new IntersectionObserver(e=>{const t=e[0];t?.isIntersecting&&!n&&(s(),r(),l.disconnect())},{root:null,rootMargin:"100px",threshold:0});l.observe(carousel)}window.addEventListener("keydown",e=>{if("Escape"===e.key)for(const e of ESCAPE_CLOSE_REGISTRY)if(e.isOpen()){e.close();break}});